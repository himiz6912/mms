# Inspection sheet

## 位置情報

### 目的

PowerAPPsアプリによりこれまでの車両GPSと違った対応ができることを確認する。
特に車両GPSは現在位置や何かあった際の位置情報の取得はできるが、MAP上に軌跡を表示するだけで、業務内容と連携しない為、以下の問題がある。

1. 駐車場から徒歩で契約先対応した場合の位置情報は取得できない。（駐車場で待機していることも考えられる）
2. 時系列で目で追わないと業務との整合性が取れない。
3. 行動者と車両が紐づかず、別途車両使用の運用規定が必要となる。
よって、モバイル端末を業務上使用することを前提とし、モバイル端末から位置情報を取得することで、上下番、指示応答などのイベント発生時や、定期的な位置情報を取得し、対応業務内容と合わせて、不正な行動がないことを確認し、また使用者に対し不正行為を抑制できることを確認する。

### 評価方法

簡単なタスク管理アプリを作成し、位置情報の自動取得による業務分析が業務効率化となることを確認する。

#### モバイル端末アプリ

1. 上下番操作: 上番することで本人の持つタスクリストを取得する。別の要員が上番することで別の要因のタスクリストを取得する
2. タスクリストの表示: 一覧（Galleryで表示する）
3. タスクの結果登録: 一覧から選択し詳細画面を表示し、対応結果を登録する。
4. 緊急指示受け: 上番中に指示を受けると通知とともに画面に指示内容を表示する。了承操作によりタスクリストに追加される。

#### デスクトップアプリ

1. 上下番管理: 上下番の状況を表示する。上番者の位置、軌跡をマップ上に表示する。
2. タスク管理: 全てのタスクリストを表示する。
3. タスク登録: タスクを登録する。未割当のタスクを要員に割り当てる。緊急指示は即時に緊急指示をする。

#### 機能概要

1. デスクトップアプリでタスクを登録する。
2. FLOWを使用し、TaskListエンティティの更新をトリガーとして、Eventエンティティを自動生成する。
3. イベント”Order”または"Change Order"については、FLOWを使用し、Eventエンティティの更新をトリガーとして、モバイルアプリ通知を行う。
4. モバイルアプリはTaskエンティティの更新操作を行う。更新時は位置情報を取得し合わせてEventエンティティに応答イベントとともに登録する。
5. デスクトップアプリから対応者別の軌跡をマップ上に表示する。（OSMを使用）

#### Entity

1. HumanResource: 要員リスト
2. Terminal: 端末リスト
3. Post:　配置
4. TaskList: タスク一覧
5. Event: 一連の履歴
6. Site: 物件情報

EventType: 新規作成、内容変更、要員割当、了承、拒否、完了報告、未完了報告、対応延期報告
Initial/ UpdateContent/ UpdateTime/ Allocate/ ReportAccept/ ReportReject/ ReportSuccess/ ReportFailue/ Pending

登録されたタスクに対する操作はすべてイベントとしてEventエンティティに記録される。
基本として、登録者＝ログインユーザー、登録日時＝現時刻とし、レコード編集時はレコードの作成、更新日時を使用する。
モバイルアプリからは位置情報LocationDataを追加する。

- 新規事案登録時、イベント”Create”、登録者＝ログインユーザー、登録日時＝レコードの作成日時、内容＝全項目のJSON
- 内容変更時、イベント”Update”、登録者＝ログインユーザー、登録日時＝レコードの更新日時、内容＝全項目のJSON
- 要員割当時、イベント”Assign”、登録者＝ログインユーザー、登録日時＝現時刻、内容＝割り当てたユーザーID
- 了解又は拒否時、イベント”Accept”または”Reject”、登録者＝ログインユーザー、登録日時＝現時刻、内容＝アプリで入力した内容
- 報告時、イベント”Report*”、登録者＝ログインユーザー、登録日時＝現時刻、内容＝アプリで入力した内容
- 終了確認時、イベント”Confirm”、登録者＝ログインユーザー、登録日時＝現時刻
- 対応開始後（Report*登録後）に対応が延期となった場合、新たな事案を作成する。イベント”Pending”、内容＝アプリで入力した内容
- 経過時間報告として、”ReportStart”から”ReportSuccess”または”ReportFail”までは30分毎に位置情報をイベント”PeriodicReport”として登録する。登録者＝”ReportStart”したユーザー、登録日時＝現時刻、内容＝無し

#### Statusについて

画面上、イベントの状況からSTATUSを追加して表示する。これにより、対応優先順位を制御する。

|Situation|Status|Remarks|
|--|--|--|
|Createから、Assignが登録されるまで|Created||
|Assignから、ReportAcceptが登録されるまで|Arranging||
|ReportAcceptからReportSuccess、ReportFailが登録されるまで|Ongoing||
|ReportSuccess、ReportFailure登録後、Confirmが登録された|Completed||
|ReportPendingが登録され、Confirmが登録された|Pending||
|Ongoing後、ReportPendingとなった場合|Arranging||
Status: Created/ Arranging/ Ongoing/ Responded/ finished/ Pending/

#### Mobile App

1. 起動後、Postエンティティを確認し、自動ログインする。（loginuserにResourceIDをセット）
2. 割当てられたが未確認の事案（TasklistエンティティのAssignedIDに自身がセットされ、かつ未完了の事案のうち、Eventエンティティで自身がAssignされたレコードの方が新しいタスク）をAssignedタスクとして表示する。
3. 受諾した場合、イベントAcceptをEventエンティティに登録し、TasklistエンティティのステータスをOngoingにする。
4. 拒否する場合、Rejectを登録する。Reject時はTextboxに理由を登録する。
5. 対応開始時は、Tasklistから対象タスクを選択し、タスク開始を選択する。
6. タスク開始を開始時に入力してもしなくても、最終的にタスク終了時には開始時刻、終了登録と事案継続の有無を登録する。
7. タスクの事案継続無し、正常化、事案終了の場合はReportSuccessをEventエンティティに登録する。
8. タスクを正常化できず、ただし事案継続不要の場合、理由をTextboxに入力の上、ReportFailureをEventエンティティに登録する。
9. 事案継続となる場合は、ReportPendingを送信する。Pendingの場合も理由の入力は必須。
10. いずれも対応開始後の報告登録はすべて位置情報をイベントに送信する。
11. 対応開始時に開始操作を行っていた場合は、その後対応完了登録するまで30分間隔で位置情報を定時連絡として登録する。

#### Desktop App

アプリで実施すること：
1. 受諾済みの未完了タスクに問題はないか
    - 対応日は確定しているか
    - 対応者はアサインできているか
    - アサインした対応者は了承しているか

2. 対応結果に問題はないか
    - 対応時間に未開始となっていないか（遅刻、対応漏れ）
    - 対応時間が多く掛かっていないか
    - 対応正常完了済み、未確認物件の確認
    - 問題ありで対応完了している物件の対応フォロー

3. 品質向上のための統計情報
    - 配置人数、対応者スキルに課題はないか（未完了が多い、遅刻が多いなど）
    - 対応フローに問題はないか（対応期限が短い、対応日調整がされていないなど）

4. 対応不備に対する指導目的
    - 特定の対応者の遅刻が多い
    - 特定の対応者の対応数が少ない
    - 特定の対応者の対応時間が長い

対応期限1週間前にステータスがOngoingとなっていないものを上位に赤色で表示する
ステータスがArrangingのものは黄色で表示する。（期限1週間前は赤色）
対応時間30分前にPUSH通知をする。（Mobile App)
対応時間になってもReportStartを受信していないタスクは赤色で表示する
ReportStartから30分経過毎にPUSH通知をする。（Mobile App）
ReportStart受信時、位置情報と物件位置がアンマッチの場合は赤字で表示する。
ReportStartから1時間経過してもReportSuccess/ReportFailureの受信のないタスクは赤色で表示する。
ReportSuccess/ReportFailure/ReportPendingを受信したタスクは黄色表示として、内容確認を促す。
地域別の対応種類、対応予定日時と開始時刻の差を正規分布図（横軸：時間、縦軸：回数、対応日時は別に選択）で表す。
要員別の対応予定日時の開始時刻の差を″
要員別の対応経過時間と対応数を散布図で表示（横軸：対応日時、縦軸:対応経過時間）


開始ｰ終了間に終了したTasklistの終了日別のTaskType別の件数表
1. StatusがFinishedのtasklistにEventからEventTypeがReportSuccess/ReportFailureのCreatedOnをマージする
2. 1.のtableからShowcolumnsを使い、カラムをDate,EmergencyDispatch,Troubleshoot...としてその件数をセットする。